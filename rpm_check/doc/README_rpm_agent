RPM AGENT

	SCR Agent for working with Red Hat Package Manager (rpm)
	and creating/reading "rpm difference Data Base" (rpm_dDB)
	
NEW TERM 
	rpm-map is a usual YCP-map where stored results of rpm-Verify:
		1. rpm name, version, release
		2. missed capabilities
		3. missed files
		4. failed files and their current status
	
	rpm-map example:
	
	$[
		"RPM_NAME" : "xf86",  # tested package name
		"RPM_RELEASE" : "45", # release
		"RPM_SHORT_NAME" : "xf86", # package short name (without version and release)
		"RPM_VERSION" : "4.1.0",   # package version
		"DAMAGED" : true,     # <boolean> damage flag. if DAMAGED==true and this rpm-map contains no one fail  -> package isn't installed
		"DEPS_FAILS" : [      # <list of failed capabilities for this rpm-package>
			"libGL.so.1",
			"libGLU.so.1"
		],
		"MISSED_FILES" : [], # <list of missed files>
		"FILE_FAILS" : $[  # <map with keys "c"-configfiles,"d"-docfiles,"l"-mainfiles>
			"c" : $[],     # conf section is void -> OK
			"d" : $[],     # doc section is void -> OK
			"l" : $[       # <map with failed keys==filenames, values are the current stat of file>
				"/usr/X11R6/bin/dga" : $[ # <map with keys==failure according to "rpm -V"-output (see man rpm)
					"M" : "755"
				],
				"/usr/X11R6/lib/X11/fonts/75dpi/encodings.dir" : $[
					"5" : "4d9cef7ffda04e7d48c55931a91b4ebb", # current md5 sum of /etc/inittab
					"M" : "644",       # current mode of file /usr/X11R6/lib/X11/fonts/75dpi/encodings.dir
					"S" : "1302",      # current size of file /usr/X11R6/lib/X11/fonts/75dpi/encodings.dir
					"T" : "1558741513" # current modification time 
				],
				"/usr/X11R6/lib/X11/fonts/misc/fonts.dir" : $[
					"5" : "8fa21893069c2cc825dab2b62bed2978",
					"M" : "644",
					"S" : "407",
					"T" : "1558741657"
				]
			]
		]
	]


USAGE

	Read (.rpm.rpm_stat, string rpm_package_name)
		verifies an installed rpm and returns a rpm-map: the failure status of a rpm-package (missed files, fail files etc.)
		returns "nil" if rpm_package_name is a void string
		
	Write (.rpm.create_rpm_dDB, string rpm_dDB_filename)
		creates a new rpm_dDB from a set of packagenames with [<path>/]filename specified by the argument 
		the set of packagenames will be filtered from files $MIN_INSTALL_LIST(minimal SuSE-installation) and $COMMON_LIST(packages for current platform)
		returns true on success/false on fail.
		
	Read (.rpm.get_rpm_dDB, string rpm_dDB_filename)		
		reads the by argument specified rpm_dDB and returns the rpm_dDB as YCP-list.
		
	Write (.rpm.add_rpm_dDB, string rpm_dDB_filename, string rpm_package_name)
		appends a new generated rpm-map to an existing rpm_dDB without to test something
		ATTENTION! the programmer have to test if rpm_dDB contains a rpm-map of rpm_package_name  
		returns true on success/ false if couldn't create or open for writing rpm_dDB_filename 
	

BUGS

	rpm_stat.awk makes a 'rpm -q --dump' call and takes the 1st word as filename -> if filename contains <whitespace> 
	this script delivers false information (look rpmpackage liblcms). 
	Afected SCR-paths: .rpm.rpm_stat, .rpm.create_rpm_dDB, .rpm.add_rpm_dDB



_______________________

DEVELOPERS INFROMATION
_______________________


STRATEGY of rpm-check/repair
	
	FUNCTION REINSTALL (RPM_NAME):
		REINSTALLATION: mark RPM_NAME-package for reinstall
		# it would be good the reinstallation do through YaST2-installation-module because it checks
		# dependecies and configures many packages.

	IF a set of packages (z.B. Minimal-installation) have to be test:
		IF a package (e.g from Minimal-installation) isn't installed:
			INSTALLATION: mark this package as "X" (YaST2: install package)
			# unsatisfied dependencies can be prevent here, but conflict-probleme can appear.
		
	WHILE (they are package to test):
		search for property-vector (say rpm-map) of the current package in rpm_dDB(rpm difference DataBase)
		IF the property-vector of rpm-package in rpm_dDB FOUND:
			calculate Differenzen between the current vector (SCR-Path .rpm.rpm_stat) and the found vector from rpm_dDB
			IF (no new/modified files, file-fail-status, dependences in rpm-package are found/affected (comparing with the vector from rpm_dDB)) OR\
				(rpm-package WITHOUT reinstallation can be returned to the backup-state ) OR \
				(new affected files stem from from doc-section [or conf-section, in case if you make conf-files-backup-copies avalible]):
					DO IT ( recover permissions, uid, gid etc., in case of conf-failes-backup: recover the conf-files)
			ELSE damaged files found about whitch they are no recover-information in rpm_dDB:
				# here will be te case of the new unsatisfied dependencies treated:
				# the package will be marked in YaST2 as "R"einstall -> automatic dependencies check
				files from main-section damaged/modified -> sequirity-alert
				[ oder files aus conf-section, falls KEIN Backup gemacht wurde]
				CALL REINSTALLATION
		ELSE:
			IF die .rpm.rpm_stat of a package rturns a rpm-map with "DAMAGED":false (key:value):
				 # i.e. this package had at the creation time of rpm_dDB any difference from rpm-database!
				 CALL REINSTALLATION
				 
	CALL YaST2-installation-module: finally dependencies test and the user can edit the list of packages to re-/install


